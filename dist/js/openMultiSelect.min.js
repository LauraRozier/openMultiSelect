/**
 * Open Multi Select for MDBootstrap
 * Version: 1.0.0
 *
 *
 * ----------------------------------------------------------------------------
 * "THE BEER-WARE LICENSE" (Revision 44):
 * Author: Thimo Braker <thibmorozier@gmail.com>
 * File: openMultiSelect.min.js
 *
 * As long as you retain this notice anywhere in the file and/or the file's
 * directory you can do whatever you want with this stuff. If we meet someday,
 * and you think this stuff is worth it, you can buy me a beer in return.
 * ----------------------------------------------------------------------------
 *
 *
 * Documentation: https://kp-wiki.org/
 *
 * Support: https://kp-wiki.org/
 *
 * Contact: contact@kp-wiki.org
 *
 * Atribution: MDBootstrap, Bootstrap 4, jQuery
 *
 */(function($,window,document,undefined){"use strict";const PLUGIN_NAMESPACE="openMultiSelect";const PLUGIN_NAMESPACE_DATA="plugin_"+PLUGIN_NAMESPACE;const ITEMS_DEFAULTS={initial:[],available:[],selected:[],};const AJAX_DEFAULTS={availableUrl:"",selectedUrl:"",method:"GET",};function Plugin(aElement,aOptions){this._name=PLUGIN_NAMESPACE;this.settings=$.extend({},$.fn[PLUGIN_NAMESPACE].defaults,aOptions);this.element=aElement;this.$element=$(this.element);this.valueElement=null;this.availableElement=null;this.selectedElement=null;this.buttonElement=null;this.items=ITEMS_DEFAULTS;this.init()}
$.extend(Plugin.prototype,{arrayRemove:function(aArray,aValue){return aArray.filter(function(item){return item!==aValue})},arrayContains:function(aNeedle,aHaystack){for(let i in aHaystack){if(aHaystack[i]===aNeedle)return!0}
return!1},cbSelectItem:function(aEvent){aEvent.preventDefault();aEvent.stopImmediatePropagation();const $caller=$(aEvent.target).removeClass("oms-item-"+aEvent.data.settings.availableItemColor).addClass("oms-item-"+aEvent.data.settings.selectedItemColor).off("click").click(aEvent.data,aEvent.data.cbUnselectItem);aEvent.data.items.selected.push($caller.val());aEvent.data.valueElement.val(JSON.stringify(aEvent.data.items.selected));$caller.appendTo(aEvent.data.selectedElement.find(".oms-list-body"))},cbUnselectItem:function(aEvent){aEvent.preventDefault();aEvent.stopImmediatePropagation();const $caller=$(aEvent.target).removeClass("oms-item-"+aEvent.data.settings.selectedItemColor).addClass("oms-item-"+aEvent.data.settings.availableItemColor).off("click").click(aEvent.data,aEvent.data.cbSelectItem);aEvent.data.items.selected=aEvent.data.arrayRemove(aEvent.data.items.selected,$caller.val());aEvent.data.valueElement.val(JSON.stringify(aEvent.data.items.selected));$caller.appendTo(aEvent.data.availableElement.find(".oms-list-body"))},cbResetSelection:function(aEvent){aEvent.preventDefault();aEvent.stopImmediatePropagation();aEvent.data.resetSelection()},cbSelectAll:function(aEvent){aEvent.preventDefault();aEvent.stopImmediatePropagation();const items=aEvent.data.availableElement.find(".oms-list-body").find(".oms-item");$.each(items,function(index,value){const $value=$(value);aEvent.data.items.selected.push($value.val());$value.removeClass("oms-item-"+aEvent.data.settings.availableItemColor).addClass("oms-item-"+aEvent.data.settings.selectedItemColor).off("click").click(aEvent.data,aEvent.data.cbUnselectItem).appendTo(aEvent.data.selectedElement.find(".oms-list-body"))});aEvent.data.valueElement.val(JSON.stringify(aEvent.data.items.selected))},cbUnselectAll:function(aEvent){aEvent.preventDefault();aEvent.stopImmediatePropagation();const items=aEvent.data.selectedElement.find(".oms-list-body").find(".oms-item");$.each(items,function(index,value){const $value=$(value);aEvent.data.items.selected=aEvent.data.arrayRemove(aEvent.data.items.selected,$value.val());$value.removeClass("oms-item-"+aEvent.data.settings.selectedItemColor).addClass("oms-item-"+aEvent.data.settings.availableItemColor).off("click").click(aEvent.data,aEvent.data.cbSelectItem).appendTo(aEvent.data.availableElement.find(".oms-list-body"))});aEvent.data.valueElement.val(JSON.stringify(aEvent.data.items.selected))},render:function(){const aeBody=this.availableElement.find(".oms-list-body").empty();const seBody=this.selectedElement.find(".oms-list-body").empty();this.valueElement.val(JSON.stringify(this.items.selected));$.each(this.items.available,(function(index,value){const listItem=$("<span />").attr({class:"oms-item"}).text(value.text).val(value.value);if(this.arrayContains(value.value,this.items.selected)){seBody.append(listItem.addClass("oms-item-"+this.settings.selectedItemColor).click(this,this.cbUnselectItem))}else{aeBody.append(listItem.addClass("oms-item-"+this.settings.availableItemColor).click(this,this.cbSelectItem))}}).bind(this))},reloadAvailableItems:function(aUrl,aIndRedraw){aUrl=(typeof aUrl!=="undefined")?aUrl:null;aIndRedraw=(typeof aIndRedraw!=="undefined")?aIndRedraw:!0;if(aUrl!==null){if(this.settings.ajax===null){this.settings.ajax=$.extend({},AJAX_DEFAULTS,{availableUrl:aUrl})}else{this.settings.ajax.availableUrl=aUrl}}
const ajaxSettings=$.extend({},AJAX_DEFAULTS,this.settings.ajax);this.items=ITEMS_DEFAULTS;$.ajax({url:ajaxSettings.availableUrl,async:!0,accepts:"application/json",cache:!1,type:this.settings.ajax.method,}).done((function(data){this.items.available=Object.assign(data);if(aIndRedraw===!0)this.render();return!0}).bind(this)).fail(function(jqXHR){alert("Unable to handle the request due to an AJAX fault!\n"+"Response : "+jqXHR.responseText);return!1})},reloadSelectedItems:function(aUrl,aIndRedraw){aUrl=(typeof aUrl!=="undefined")?aUrl:null;aIndRedraw=(typeof aIndRedraw!=="undefined")?aIndRedraw:!0;if(aUrl!==null){if(this.settings.ajax===null){this.settings.ajax=$.extend({},AJAX_DEFAULTS,{selectedUrl:aUrl})}else{this.settings.ajax.selectedUrl=aUrl}}
const ajaxSettings=$.extend({},AJAX_DEFAULTS,this.settings.ajax);this.items=ITEMS_DEFAULTS;$.ajax({url:ajaxSettings.selectedUrl,async:!0,accepts:"application/json",cache:!1,type:this.settings.ajax.method,}).done((function(data){this.items.initial=Array.from(data);this.items.selected=Array.from(data);if(aIndRedraw===!0)this.render();return!0}).bind(this)).fail(function(jqXHR){alert("Unable to handle the request due to an AJAX fault!\n"+"Response : "+jqXHR.responseText);return!1})},reloadItems:function(aAvailableUrl,aSelectedUrl,aIndRedraw){aAvailableUrl=(typeof aAvailableUrl!=="undefined")?aAvailableUrl:null;aSelectedUrl=(typeof aSelectedUrl!=="undefined")?aSelectedUrl:null;aIndRedraw=(typeof aIndRedraw!=="undefined")?aIndRedraw:!0;if(this.reloadAvailableItems(aAvailableUrl,!1)&&this.reloadSelectedItems(aSelectedUrl,!1))if(aIndRedraw===!0)this.render()},resetSelection:function(){this.items.selected=Array.from(this.items.initial);this.render()},clearItems:function(){this.items=ITEMS_DEFAULTS;this.render()},setAvailableItems:function(aAvailableItems,aIndRedraw){aIndRedraw=(typeof aIndRedraw!=="undefined")?aIndRedraw:!0;this.items.available=Object.assign(aAvailableItems);if(aIndRedraw===!0)this.render()},setSelectedItems:function(aSelectedItems,aIndRedraw){aIndRedraw=(typeof aIndRedraw!=="undefined")?aIndRedraw:!0;this.items.initial=Array.from(aSelectedItems);this.items.selected=Array.from(aSelectedItems);if(aIndRedraw===!0)this.render()},setItems:function(aAvailableItems,aSelectedItems,aIndRedraw){aIndRedraw=(typeof aIndRedraw!=="undefined")?aIndRedraw:!0;this.setAvailableItems(aAvailableItems,!1);this.setSelectedItems(aSelectedItems,!1);if(aIndRedraw===!0)this.render()},init:function(){this.valueElement=$("<input />").attr({name:this.settings.name,type:"hidden",});this.availableElement=$("<div />").attr({class:"oms-available-list",}).append($("<div />").attr({class:"oms-list-header oms-list-header-"+this.settings.headerColor,}).text("Available Items"),$("<div />").attr({class:"oms-list-body"}));this.selectedElement=$("<div />").attr({class:"oms-selected-list",}).append($("<div />").attr({class:"oms-list-header oms-list-header-"+this.settings.headerColor,}).text("Selected Items"),$("<div />").attr({class:"oms-list-body"}));this.buttonElement=$("<div />").attr({class:"oms-controls",}).append($("<button />").attr({class:"btn btn-block btn-"+this.settings.buttonColor+" mb-1",}).text("Reset Selection").click(this,this.cbResetSelection),$("<button />").attr({class:"btn btn-block btn-"+this.settings.buttonColor+" mt-3",}).text("Select All").click(this,this.cbSelectAll),$("<button />").attr({class:"btn btn-block btn-"+this.settings.buttonColor+" mt-3",}).text("Unselect All").click(this,this.cbUnselectAll));this.$element.append($("<div />").attr({class:"row mt-5 mb-4 clearfix",}).append(this.valueElement,this.availableElement,this.buttonElement,this.selectedElement));if(this.settings.ajax!==null)this.reloadItems()},destroy:function(){this.$element.each(function(index,value){value.clearItems();$(value).removeData(PLUGIN_NAMESPACE_DATA)})},});$.fn.openMultiSelect=function(aOptions){const args=Array.prototype.slice.call(arguments,1);if(aOptions===undefined||typeof aOptions==="object"){return this.each(function(index,value){if(!$.data(value,PLUGIN_NAMESPACE_DATA)){$.data(value,PLUGIN_NAMESPACE_DATA,new Plugin(value,aOptions))}})}
if(typeof aOptions==="string"&&aOptions[0]!=="_"&&aOptions!=="init"){let returns;this.each(function(index,value){const instance=$.data(value,PLUGIN_NAMESPACE_DATA);if(instance instanceof Plugin&&typeof instance[aOptions]==="function"){returns=instance[aOptions].apply(instance,args)}});return returns!==undefined?returns:this}
return this};$.fn.openMultiSelect.defaults={name:"oms-value-input",ajax:null,availableItemColor:"red",selectedItemColor:"green",buttonColor:"primary",headerColor:"mdb-color",}})(jQuery,window,document);